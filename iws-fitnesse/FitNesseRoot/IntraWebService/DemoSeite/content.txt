#!include -setup .ZobelMainPage.SetUp

!1 Definieren von Konstanten

''' Definieren von Konstanten: '''
!define DILBERT_STNR    {9181081508155}
!define DILBERT_ZID     {ZO11039876526}
!define ADALBERT_STNR   {4151081508167}
!define ADALBERT_ZID    {ZO15738216492}

''' Definieren von XML-Strings, so dass Sie später angezeigt und verwendet werden können: '''
!define IMPORT_XML     {!<
<GINSTER xmlns="http://ginster.hzd.hessen.de/2006/XMLSchema" version="000006" land="NW">
<Request benutzerId="zobelclient" lieferant="zobel">
<UpdateList>
<Update>
  <AnwInfo anw="Neu" fachlVerfuegungsDat="20080331171016" infotext="initial"/>
  <Steuerkonto stNr="5133081508159" typ="0">
	  <Allgemein neuaufnahmeDatum="19990304">
	    <KBListe>
	      <KB ab="20050101" kb="A" zusatzWert="114"/>
	    </KBListe>
	  </Allgemein>
	  <Verweise>
	    <Verweis verweisId="27" verwSteuerart="0030" stNr="9909000430573" verweisLfdNr="00001" verwDatum="20070427"/>
	    <Verweis verweisId="28" verwSteuerart="0030" stNr="9901000101922" verweisLfdNr="00001" verwDatum="19991009"/>
	    <Verweis verweisId="28" verwSteuerart="0200" stNr="9901000101922" verweisLfdNr="00002" verwDatum="19991009"/>
	  </Verweise>
	</Steuerkonto>
</Update>
</UpdateList>
</Request>
</GINSTER>
>!}


!define WRONG_XML     {!<
<GINSTER xmlns="http://ginster.hzd.hessen.de/2006/XMLSchema" version="000006" land="NW">
<Request benutzerId="zobelclient" lieferant="zobel">
<UpdateList2>

</UpdateList>
</Request>
</GINSTER>
>!}

!define XML_ADDRESS     {!<<?xml version="1.0" encoding="ISO-8859-15"?>
<GINSTER xmlns="http://ginster.hzd.hessen.de/2006/XMLSchema" version="000006" land="HE">
	<Response dbStand="20100428">
		<GetErgebnisListe ergAnz="1">
			<Ergebnis stNrId="42469" status="A" quelle="Bestand" statusDat="20070712">
				<Steuerkonto stNr="4151081508167" typ="0">
					<Inhaber>
						<NatPers anredeId="1" name="FrankensteinXXXXXXX" vorname="Adalbert" titel="titel" vorsatz="vorsatz" zusatz="zusatz">
							<AdrKette aenderungsDat="20070712153613">
								<StrAdr plz="65428" ort="Frankenstein" adressArt="1" str="Dorfanger" hausNr="15"/>
							</AdrKette>
							<Taetigkeit taetigkeitsId="190" ab="19800101"/>
						</NatPers>
					</Inhaber>
				</Steuerkonto>
				<AnwInfos>
					<AnwInfo anw="Neu" benutzerId="vonHZD vonHZD    " fachlVerfuegungsDat="20070712153613" aendinfo="" lieferant="update" technBearbDat="20100428143144"/>
				</AnwInfos>
			</Ergebnis>
		</GetErgebnisListe>
	</Response>
</GINSTER>
>!}

---------

!1 Entleeren der ZObEL-DB und der GINSTER-DB

''' Entleeren der ZObEL-DB und der GINSTER-DB: '''
|script|database controller|
|clean database            |
|clean ginster             |

---------

!1 Initialisieren der ZObEL-DB

''' Schreiben von Daten in die ZObEL-DB: '''
|script          |database controller                                                                                                     |
|add !-BUFA-! for|Finanzamt|with value|1234           |and datum|2010-01-01                                                               |
|add !-IdNr-! for|DilberIDo|with value|91039876522    |and datum|2010-01-01|and zid |ZO11463523567                                        |
|add !-StNr-! for|Test     |with value|9999000000004  |and datum|2000-01-01|and GKBA|true |and lebenszyklusstatus|A                       |
|add !-StNr-! for|Adalbert |with value|4151081508167  |and datum|2010-01-01|and GKBA|true |and lebenszyklusstatus|A|and zid|ZO15738216492 |
|add !-StNr-! for|Dilbert  |with value|${DILBERT_STNR}|and datum|2010-06-01|and GKBA|true |and lebenszyklusstatus|A|and zid|${DILBERT_ZID}|
|add !-StNr-! for|Dilbert  |with value|${DILBERT_STNR}|and datum|2009-07-01|and GKBA|false|and lebenszyklusstatus|K|and zid|${DILBERT_ZID}|
|add !-StNr-! for|Dilbert  |with value|${DILBERT_STNR}|and datum|2009-09-01|and GKBA|false|and lebenszyklusstatus|W|and zid|${DILBERT_ZID}|
|add !-StNr-! for|Dilbert  |with value|${DILBERT_STNR}|and datum|2009-10-01|and GKBA|false|and lebenszyklusstatus|L|and zid|${DILBERT_ZID}|
|fill data into database                                                                                                                  |


''' Ausführen von GINSTER Initialdaten Import mit XML aus KONSTANTEN-Defintion "IMPORT_XML" (siehe oben): '''
|script             |database controller|
|initial import text|${IMPORT_XML} |    |
|check              |importIsOk    |true|
|show               |importErrorMessage |
|fill data into database                |


''' Ausführen von GINSTER Tageslieferungs Import mit XML aus KONSTANTEN-Defintion "WRONG_XML" (siehe oben): '''
|script             |database controller                    |
|initial import text|${WRONG_XML}   |                       |
|check              |importIsOk     |false                  |
|check              |importErrorCode|${GINSTER_DATA_INVALID}|
|show               |importErrorMessage                     |
|fill data into database                                    |


''' Ausführen von GINSTER Initialdaten Import mit XML aus Datei "initialGinsterImport.xml" (und danach:) '''
''' Ausführen von GINSTER Tageslieferungs Import mit XML aus Datei "updateGinsterImport.xml": '''
{{{ 
    |initial import file|initialGinsterImport.xml|  |
    |update import file |updateGinsterImport.xml |  |
}}}


---------

!1  Initialisieren der GINSTER-DB mit Responses für GINSTER-Online Abfragen

''' Entleeren der ZObEL-DB und der GINSTER-DB (und danach:) '''
|script|database controller|
|clean database            |
|clean ginster             |


''' Einlesen von Standard-Ginster-Online-Response XML Files in die GINSTER-DB mit bestimmtem Datum: '''
|script                            |database controller|
|initialize ginster data with datum|20100101           |


''' Einfügen eines GINSTER-Online-Response XML aus KONSTANTEN-Defintion "XML_ADDRESS" für eine Steuernummer in die GINSTER-DB (und danach:) '''
''' Einfügen eines GINSTER-Online-Response XML aus KONSTANTEN-Defintion "XML_ADDRESS" für eine Steuernummer und Datum in die GINSTER-DB '''
|script                  |database controller                                             |
|add Ginster Response for|${ADALBERT_STNR}|with value|${XML_ADDRESS}                      |
|add Ginster Response for|${DILBERT_STNR} |at datum  |2010-01-02|with value|${XML_ADDRESS}|


''' Einlesen eines GINSTER-Online-Response XML aus Datei "initialGinsterImport.xml" für eine Steuernummer in die GINSTER-DB (und danach:) '''
''' (Die XML-Files müssen im Verzeichnis "/zobel-fitnesse/src/main/resources/xml/online_examples/*.xml" liegen.) '''
|script                       |database controller                                                                                                               |
|add Ginster Response File for|9199000000003|with value|rev2/AdressResponse_9199000000003_BY_T1_NatPers_Betriebsliste_Schema000006_rev2.xml                      |
|add Ginster Response File for|9199000000003|at datum  |2010-01-02|with value|rev2/AdressResponse_9199000000004_BY_T2_NatPers_Betriebsliste_Schema000006_rev2.xml|

