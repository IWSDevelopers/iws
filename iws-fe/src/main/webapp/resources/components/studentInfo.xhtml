<ui:component xmlns=""
              xmlns:ui="http://java.sun.com/jsf/facelets"
              xmlns:composite="http://java.sun.com/jsf/composite"
              xmlns:h="http://java.sun.com/jsf/html"
              xmlns:p="http://primefaces.org/ui"
              xmlns:f="http://java.sun.com/jsf/core">

    <composite:interface>
        <composite:attribute name="offer" required="true" type="net.iaeste.iws.fe.model.Offer"/>
    </composite:interface>

    <composite:implementation>
        <p:fieldset>
            <ul>
                <li>
                    <h:outputLabel for="fieldsOfStudy" value="#{amsg.fieldsOfStudy}"/>

                    <p:outputPanel id="fieldsOfStudy" autoUpdate="true">
                        <ui:repeat value="#{cc.attrs.offer.fieldsOfStudy}" var="studyField" varStatus="status">

                            <div class="ui-autocomplete-token ">
                                <h:outputText styleClass="ui-autocomplete-token-label" value="#{studyField}"/>
                                <p:commandLink action="#{cc.attrs.offer.removeFieldOfStudy(status.index)}" process="@this"
                                               styleClass="ui-autocomplete-token-icon ui-icon ui-icon-close"/>
                            </div>
                        </ui:repeat>
                    </p:outputPanel>

                    <p:autoComplete value="#{offerBean.selectedFieldOfStudy}" dropdown="true" required="true"
                                    completeMethod="#{offerBean.completeFieldsOfStudy}"
                                    disabled="#{cc.attrs.offer.fieldsOfStudy.size() &gt;= 3}" styleClass="xLargeInput">
                        <p:ajax event="itemSelect" process="@this" update="fieldsOfStudy @this"/>
                    </p:autoComplete>

                    <h:message for="fieldsOfStudy" errorClass="error"/>
                </li>
                <li>
                    <p:outputLabel for="specialization" value="#{amsg.specialization}"/>
                    <p:inputText id="specialization" value="#{cc.attrs.offer.specialization}" styleClass="xLargeInput"/>
                    <h:message for="specialization" errorClass="error"/>
                </li>
                <li>
                    <p:outputLabel for="studyLevel" value="#{amsg.studyLevel}"/>
                    <p:selectManyCheckbox id="studyLevel" value="#{cc.attrs.offer.studyLevels}" layout="pageDirection" required="true"
                                          label="#{amsg.studyLevel}">
                        <f:selectItems value="#{offerBean.studyLevels}" var="p"
                                       itemLabel="#{amsg.handleGetObject(enumHelper.toMessageKey(p))}"/>
                        <p:ajax process="@this"/>
                    </p:selectManyCheckbox>
                    <h:message for="studyLevel" errorClass="error"/>
                </li>
                <li>
                    <p:outputLabel for="previousTrainingRequired" value="#{amsg.previousTrainingRequired}"/>
                    <p:selectBooleanCheckbox id="previousTrainingRequired" value="#{cc.attrs.offer.previousTrainingRequired}"/>
                    <h:message for="previousTrainingRequired" errorClass="error"/>
                </li>
                <li>
                    <p:outputLabel for="otherRequirements" value="#{amsg.otherRequirements}"/>
                    <p:inputTextarea id="otherRequirements" value="#{cc.attrs.offer.otherRequirements}" rows="6" counter="counter" maxlength="500"
                                     counterTemplate="{0} #{amsg.remainingCharactersMessage}" styleClass="xxLargeInput"/>
                    <h:outputText id="counter" styleClass="description"/>
                    <h:message for="otherRequirements" errorClass="error"/>
                </li>
                <li>
                    <p:outputLabel for="gender" value="#{amsg.gender}"/>
                    <p:selectOneRadio id="gender" value="#{cc.attrs.offer.gender}" required="true">
                        <f:selectItems value="#{offerBean.genders}" var="p"
                                       itemLabel="#{amsg.handleGetObject(enumHelper.toMessageKey(p))}"/>
                    </p:selectOneRadio>
                    <h:message for="gender" errorClass="error"/>
                </li>
                <li>
                    <h:outputLabel for="languages" value="#{amsg.languageLabel}"/>
                    <p:outputPanel id="languages" autoUpdate="true">
                        <ui:repeat value="#{cc.attrs.offer.languages}" var="wrapper" varStatus="status">

                            <p:selectOneMenu value="#{cc.attrs.offer.languageOperators[status.index - 1]}" styleClass="smallInput"
                                             rendered="#{status.index != 0}" converter="languageOperatorConverter">
                                <f:selectItems value="#{offerBean.languageOperators}" var="l"
                                               itemLabel="#{amsg.handleGetObject(enumHelper.toMessageKey(l))}"
                                               itemValue="#{l}"/>
                                <p:ajax process="@this"/>
                            </p:selectOneMenu>

                            <p:spacer width="20px" rendered="#{status.index != 0}"/>

                            <h:outputText value="(" rendered="#{not cc.attrs.offer.allLanguageOperatorsMatch() and status.index == 1}"/>

                            <p:selectOneMenu value="#{wrapper.language}" styleClass="LargeInput">
                                <f:selectItem itemLabel="#{amsg.selectLanguage}" itemValue="#{null}"/>
                                <f:selectItems value="#{offerBean.languages}" var="l"
                                               itemLabel="#{amsg.handleGetObject(enumHelper.toMessageKey(l))}"
                                               itemValue="#{l}" itemDisabled="#{cc.attrs.offer.isLanguageSelected(l, status.index)}"/>
                                <p:ajax process="@this"/>
                            </p:selectOneMenu>

                            <p:selectOneMenu value="#{wrapper.level}" styleClass="LargeInput">
                                <f:selectItems value="#{offerBean.languageLevels}" var="p"
                                               itemLabel="#{amsg.handleGetObject(enumHelper.toMessageKey(p))}"
                                               itemValue="#{p}"/>
                                <p:ajax process="@this"/>
                            </p:selectOneMenu>

                            <h:outputText value=")" rendered="#{not cc.attrs.offer.allLanguageOperatorsMatch() and status.index == 2}"/>

                            <p:commandButton process="@this" icon="ui-icon-circle-minus" immediate="true"
                                             action="#{cc.attrs.offer.removeLanguageWithOperator(status.index)}"
                                             rendered="#{cc.attrs.offer.languages.size() &gt; 1}"/>

                            <p:spacer width="20px"/>
                        </ui:repeat>

                        <p:commandButton process="@this" icon="ui-icon-circle-plus" immediate="true" action="#{cc.attrs.offer.addLanguageWithOperator()}"
                                         disabled="#{not cc.attrs.offer.canAddAnotherLanguage()}" rendered="#{cc.attrs.offer.languages.size() &lt; 3}"/>
                    </p:outputPanel>
                </li>
                <li>
                    <composite:renderFacet name="actions" required="false"/>
                </li>
            </ul>
        </p:fieldset>

    </composite:implementation>

</ui:component>